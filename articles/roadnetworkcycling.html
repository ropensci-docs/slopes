<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="slopes">
<title>Example: gradients of a road network for a given city • slopes</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example: gradients of a road network for a given city">
<meta property="og:description" content="slopes">
<meta property="og:image" content="https://docs.ropensci.org/slopes/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">slopes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/slopes.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/benchmark.html">Benchmarking slopes calculation</a>
    <a class="dropdown-item" href="../articles/intro-to-slopes.html">An introduction to slopes</a>
    <a class="dropdown-item" href="../articles/roadnetworkcycling.html">Example: gradients of a road network for a given city</a>
    <a class="dropdown-item" href="../articles/verification.html">Verification of slopes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/slopes/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example: gradients of a road network for a given city</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/slopes/blob/HEAD/vignettes/roadnetworkcycling.Rmd" class="external-link"><code>vignettes/roadnetworkcycling.Rmd</code></a></small>
      <div class="d-none name"><code>roadnetworkcycling.Rmd</code></div>
    </div>

    
    
<p>An example of the demand for data provided by the <code>slopes</code> package is a map showing gradients across São Paulo (Brazil, see image below), with a simplistic classification for cycling difficulty.</p>
<div class="figure">
<img src="https://pbs.twimg.com/media/ErJ2dr8WMAIHwMn?format=jpg&amp;name=small" alt=""><p class="caption">using slopes() to create a road network gradient for cycling for São Paulo (Brazil)</p>
</div>
<p>This vignette will guide through the production of an interactive slope map for a road network, using <code>slopes</code>, <code>osmextract</code>, <code>sf</code>, <code>stplanr</code> and <code>tmap</code>.</p>
<p>For the convenience of sample, we will use <a href="https://en.wikipedia.org/wiki/Isle_of_Wight" class="external-link">Isle of Wight</a> case, with 384 km<sup>2</sup>. See <a href="#other-examples">Other examples</a> below.</p>
<p>This will follow three steps:</p>
<ol style="list-style-type: decimal">
<li>Download of road network from <a href="https://www.openstreetmap.org/" class="external-link">OpenStreetMap</a>
</li>
<li>Prepare the network</li>
<li>Compute slopes and export the map in html</li>
</ol>
<div class="section level2">
<h2 id="extract-the-osm-network-from-geofabrik">Extract the OSM network from geofabrik<a class="anchor" aria-label="anchor" href="#extract-the-osm-network-from-geofabrik"></a>
</h2>
<p>For this step you may use <code>osmextract</code> <a href="https://ropensci.github.io/osmextract/articles/osmextract.html" class="external-link">package</a> which downloads the most recent information available at OSM (<a href="https://download.geofabrik.de/index.html" class="external-link uri">https://download.geofabrik.de/index.html</a>) and converts to <em>GeoPackage</em> (.gpkg), the equivalent to <em>shapefile</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co"># remotes::install_github("ITSLeeds/osmextract")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmextract/" class="external-link">osmextract</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the network</span></span>
<span><span class="va">iow_osm</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_get.html" class="external-link">oe_get</a></span><span class="op">(</span><span class="st">"Isle of Wight"</span>, provider <span class="op">=</span> <span class="st">"geofabrik"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                 quiet <span class="op">=</span> <span class="cn">FALSE</span>, force_download <span class="op">=</span> <span class="cn">TRUE</span>, force_vectortranslate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># 7 MB</span></span>
<span></span>
<span><span class="co"># filter the major roads</span></span>
<span><span class="va">iow_network</span> <span class="op">=</span> <span class="va">iow_osm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">highway</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'primary'</span>, <span class="st">"primary_link"</span>, <span class="st">'secondary'</span>,<span class="st">"secondary_link"</span>, </span>
<span>                               <span class="st">'tertiary'</span>, <span class="st">"tertiary_link"</span>, <span class="st">"trunk"</span>, <span class="st">"trunk_link"</span>, </span>
<span>                               <span class="st">"residential"</span>, <span class="st">"cycleway"</span>, <span class="st">"living_street"</span>, <span class="st">"unclassified"</span>, </span>
<span>                               <span class="st">"motorway"</span>, <span class="st">"motorway_link"</span>, <span class="st">"pedestrian"</span>, <span class="st">"steps"</span>, <span class="st">"track"</span><span class="op">)</span><span class="op">)</span> <span class="co">#remove: "service"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="clean-the-road-network">Clean the road network<a class="anchor" aria-label="anchor" href="#clean-the-road-network"></a>
</h2>
<p>These are optional steps that give better results, although they may slow down the process since they increase the number of segments present in the network.</p>
<div class="section level3">
<h3 id="filter-the-unconnected-segments">Filter the unconnected segments<a class="anchor" aria-label="anchor" href="#filter-the-unconnected-segments"></a>
</h3>
<p>The <a href="https://docs.ropensci.org/stplanr/reference/rnet_group.html" class="external-link"><code>rnet_group()</code></a> function from <code>stplanar</code> package assesses the connectivity of each segment assigns a group number (similar to a clustering process). Then we may filter the main group, the one with more connected segments.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github("ropensci/stplanr")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/stplanr" class="external-link">stplanr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter unconnected roads</span></span>
<span><span class="va">iow_network</span><span class="op">$</span><span class="va">group</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/rnet_group.html" class="external-link">rnet_group</a></span><span class="op">(</span><span class="va">iow_network</span><span class="op">)</span></span>
<span><span class="va">iow_network_clean</span> <span class="op">=</span> <span class="va">iow_network</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># the network with more connected segments</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="break-the-segments-on-vertices">Break the segments on vertices<a class="anchor" aria-label="anchor" href="#break-the-segments-on-vertices"></a>
</h3>
<p>A very long segment will have an assigned average slope, but a very long segment can be broken into its nodes and have its own slope in each part of the segment. On one hand, we want the segments to break at their nodes. On the other hand, we don’t want artificial <em>nodes</em> to be created where two lines cross, in particular where they have different <strong>z</strong> levels (<em>eg.</em> <em>brunels</em>: bridges and tunnels).</p>
<p>The <a href="https://docs.ropensci.org/stplanr/reference/rnet_breakup_vertices.html" class="external-link"><code>rnet_breakup_vertices</code></a> from <code>stplanr</code> breaks the segments at their inner vertices, preserving the <strong>brunels</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iow_network_segments</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/rnet_breakup_vertices.html" class="external-link">rnet_breakup_vertices</a></span><span class="op">(</span><span class="va">iow_network_clean</span><span class="op">)</span></span></code></pre></div>
<p>In this case, there are around 1.6 x the number of segments than in the original network.</p>
<!-- x segments than the original network. -->
</div>
</div>
<div class="section level2">
<h2 id="get-slope-values-for-each-segment">Get slope values for each segment<a class="anchor" aria-label="anchor" href="#get-slope-values-for-each-segment"></a>
</h2>
<p>For this case we will use <code><a href="../reference/slope_raster.html">slope_raster()</a></code> <a href="https://ropensci.github.io/slopes/reference/slope_raster.html" class="external-link">function</a>, to retrieve the z values from a digital elevation model. This raster was obtained from STRM NASA mission.</p>
<p>The <strong>SRTM</strong> (<em>Shuttle Radar Topography Mission</em>) NASA’s mission provides <a href="https://gisgeography.com/srtm-shuttle-radar-topography-mission/" class="external-link">freely available</a> worldwide DEM, with a resolution of 25 to 30m and with a vertical accuracy of 16m - <a href="https://www2.jpl.nasa.gov/srtm/" class="external-link">more</a>. The resolution for USA might be better.</p>
<p>Alternatively, <strong>COPERNICUS</strong> ESA’s mission also provides <a href="https://land.copernicus.eu/imagery-in-situ/eu-dem" class="external-link">freely available</a> DEM for all Europe, with a 25m resolution and a vertical accuracy of 7m - <a href="https://land.copernicus.eu/user-corner/publications/eu-dem-flyer/view" class="external-link">more</a>.</p>
<p>Depending of how large is your road network, you can use <code><a href="../reference/elevation_add.html">elevation_add()</a></code> <a href="https://ropensci.github.io/slopes/reference/elevation_add.html" class="external-link">function</a> - this will require a valid <a href="https://docs.mapbox.com/api/overview/" class="external-link">Mapbox api key</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import and plot DEM</span></span>
<span><span class="va">u</span> <span class="op">=</span> <span class="st">"https://github.com/U-Shift/Declives-RedeViaria/releases/download/0.2/IsleOfWightNASA_clip.tif"</span></span>
<span><span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">u</span>, destfile <span class="op">=</span> <span class="va">f</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="va">dem</span> <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co"># res(dem) #27m of resolution</span></span>
<span><span class="va">network</span> <span class="op">=</span> <span class="va">iow_network_segments</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">network</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#check if they overlay</span></span></code></pre></div>
<p>All the required data is prepared to estimate the road segments’ gradient.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the slope value for each segment (abs), using slopes package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/slopes">slopes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/geodist" class="external-link">geodist</a></span><span class="op">)</span></span>
<span><span class="va">network</span><span class="op">$</span><span class="va">slope</span> <span class="op">=</span> <span class="fu"><a href="../reference/slope_raster.html">slope_raster</a></span><span class="op">(</span><span class="va">network</span>, <span class="va">dem</span><span class="op">)</span></span>
<span><span class="va">network</span><span class="op">$</span><span class="va">slope</span> <span class="op">=</span> <span class="va">network</span><span class="op">$</span><span class="va">slope</span><span class="op">*</span><span class="fl">100</span> <span class="co">#percentage</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">network</span><span class="op">$</span><span class="va">slope</span><span class="op">)</span> <span class="co">#check the values</span></span></code></pre></div>
<p>Half of the road segments in Isle of Wight have a gradient below 3.1%. <!-- %. --></p>
<p>We will adopt a simplistic qualitative classification for <strong>cycling effort uphill</strong>, and compare the number of segments in each class.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Classify slopes</span></span>
<span><span class="va">network</span><span class="op">$</span><span class="va">slope_class</span> <span class="op">=</span> <span class="va">network</span><span class="op">$</span><span class="va">slope</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0-3: flat"</span>, <span class="st">"3-5: mild"</span>, <span class="st">"5-8: medium"</span>, <span class="st">"8-10: hard"</span>, </span>
<span>               <span class="st">"10-20: extreme"</span>, <span class="st">"&gt;20: impossible"</span><span class="op">)</span>,</span>
<span>    right <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">network</span><span class="op">$</span><span class="va">slope_class</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<!-- It means that **%** of the roads are flat or almost flat (0-3%) and about **%** of the roads are easily cyclable (0-5%). -->
<p>It means that <strong>49%</strong> of the roads are flat or almost flat (0-3%) and about <strong>75%</strong> of the roads are easily cyclable (0-5%).</p>
<p>Now let us put this information on a map (see <a href="https://rpubs.com/RobinLovelace/781081" class="external-link">here</a> for interactive version).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># more useful information</span></span>
<span><span class="va">network</span><span class="op">$</span><span class="va">length</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">network</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make an interactive map</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="va">palredgreen</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#267300"</span>, <span class="st">"#70A800"</span>, <span class="st">"#FFAA00"</span>, <span class="st">"#E60000"</span>, <span class="st">"#A80000"</span>, <span class="st">"#730000"</span><span class="op">)</span> <span class="co">#color palette</span></span>
<span><span class="co"># tmap_mode("view")</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_options.html" class="external-link">tmap_options</a></span><span class="op">(</span>basemaps <span class="op">=</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/leaflet/man/providers.html" class="external-link">providers</a></span><span class="op">$</span><span class="va">CartoDB.Positron</span><span class="op">)</span> <span class="co">#basemap</span></span>
<span></span>
<span><span class="va">slopemap</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">network</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span></span>
<span>    col <span class="op">=</span> <span class="st">"slope_class"</span>,</span>
<span>    palette <span class="op">=</span> <span class="va">palredgreen</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span>, <span class="co">#line width</span></span>
<span>    title.col <span class="op">=</span> <span class="st">"Slope [%]"</span>,</span>
<span>    popup.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Highway"</span> <span class="op">=</span> <span class="st">"highway"</span>,</span>
<span>                   <span class="st">"Length"</span> <span class="op">=</span> <span class="st">"length"</span>,</span>
<span>                  <span class="st">"Slope: "</span> <span class="op">=</span> <span class="st">"slope"</span>,</span>
<span>                  <span class="st">"Class: "</span> <span class="op">=</span> <span class="st">"slope_class"</span><span class="op">)</span>,</span>
<span>    popup.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="co"># id = "slope"</span></span>
<span>    id <span class="op">=</span> <span class="st">"name"</span> <span class="co">#if it gets too memory consuming, delete this line</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">slopemap</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#export to html</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_save.html" class="external-link">tmap_save</a></span><span class="op">(</span><span class="va">slopemap</span>, <span class="st">"html/SlopesIoW.html"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># export information as geopackage</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">network</span>, <span class="st">"shapefiles/SlopesIoW.gpkg"</span>, append<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="result">Result:<a class="anchor" aria-label="anchor" href="#result"></a>
</h4>
<p><img src="https://user-images.githubusercontent.com/1825120/121820334-2435f080-cc8a-11eb-962c-79dcba97e459.png"></p>
<ul>
<li><a href="http://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/SlopesIoW.html" class="external-link">Isle of Wight (UK)</a></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="other-examples">Other examples<a class="anchor" aria-label="anchor" href="#other-examples"></a>
</h2>
<ul>
<li><a href="https://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/DeclivesSaoPaulo.html" class="external-link">São Paulo (Brazil)</a></li>
<li><a href="https://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/DeclivesLisboa.html" class="external-link">Lisbon (Portugal)</a></li>
<li><a href="https://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/DeclivesPorto_EU.html" class="external-link">Oporto (Portugal)</a></li>
<li><a href="https://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/SlopesLeeds.html" class="external-link">Leeds (UK)</a></li>
<li><a href="https://web.tecnico.ulisboa.pt/~rosamfelix/gis/declives/SlopesZurich.html" class="external-link">Zurich (CH)</a></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
